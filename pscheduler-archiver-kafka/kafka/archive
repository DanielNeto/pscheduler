#!/usr/bin/python
"""
DESCRIPTION
"""

import sys
import pscheduler
import kafka

MAX_SCHEMA = 1

def archive(json):
    #Do archiving here

    data = json["data"]    
    
    try:
	print("try block entered")
        producer = KafkaProducer(bootstrap_servers=data["server-address"])
	print("producer created")
	producer.send(data["topic"], b"I am trying to archive!").get(timeout=30)
	print("test message sent")
        producer.send(data["topic]), pscheduler.json_dump(json["result"])).get(timeout=30)
        
    except Exception as e:
        result = {
            "succeeded": False,
            "error": "Failed to send message"
        }
        return result

    return {'succeeded': True}




PARSER = pscheduler.RFC7464Parser(sys.stdin)
EMITTER = pscheduler.RFC7464Emitter(sys.stdout)

for parsed in PARSER:
    EMITTER(archive(parsed))

pscheduler.succeed()
